<!-- Nuevo Producto Modal -->
<div id="nuevo-producto-container" class="ventana-flotante" style="display:block; z-index:9999; position:fixed; top:80px; left:80px; min-width:700px; max-width:900px;">
    <div class="draggable-handler ventana-flotante-header" style="cursor:move; background:#222; color:#fff; padding:8px; display:flex; align-items:center;">
        <span><i class="fas fa-plus-circle"></i> Nuevo Producto</span>
        <div class="window-controls ms-auto">
            <button type="button" class="btn btn-sm btn-light window-minimize" title="Minimizar">
                <i class="fas fa-window-minimize"></i>
            </button>
            <button type="button" class="btn btn-sm btn-light window-close" title="Cerrar">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    <div class="ventana-flotante-body" style="background:#181818; color:#fff; padding:16px;">
        <form id="form-nuevo-producto" autocomplete="off">
            <div style="display: flex; gap: 24px; flex-wrap: wrap;">
                <div style="flex:1; min-width: 250px;">
                    <div class="mb-2">
                        <label for="codigo">Código:</label>
                        <input type="number" id="codigo" class="form-control" required>
                    </div>
                    <div class="mb-2">
                        <label for="nombre">Descripción:</label>
                        <input type="text" id="nombre" class="form-control" required placeholder="Descripción">
                    </div>
                    <div class="mb-2">
                        <label for="linea">Línea:</label>
                        <select id="linea" class="form-control" required>
                            <% lineas.forEach(function(linea, idx) { %>
                                <option value="<%= linea.COD_LINE %>"><%= linea.DESCR %></option>
                            <% }); %>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label for="isv">ISV:</label>
                        <select id="isv" class="form-control" required>
                            <% isv.forEach(function(item, idx) { %>
                                <option value="<%= item.COD_TAX %>" data-rate="<%= item.RATE || 0 %>"><%= item.DESCR %></option>
                            <% }); %>
                        </select>
                    </div>
                </div>
                <div style="flex:1; min-width: 250px;">
                    <div class="mb-2">
                        <label for="cantidad">Cantidad:</label>
                        <input type="number" id="cantidad" class="form-control" value="0" readonly>
                    </div>
                    <div class="mb-2">
                        <label for="costo_unitario">Costo Unitario:</label>
                        <input type="number" id="costo_unitario" class="form-control" required>
                    </div>
                    <div class="mb-2">
                        <label for="precio">Precio Público:</label>
                        <input type="number" id="precio" class="form-control" required>
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button type="button" id="btnAgregarNuevoProducto" class="btn btn-success">Agregar Producto</button>
                <button type="button" id="btnEliminarNuevoProducto" class="btn btn-danger">Eliminar Producto</button>
                <button type="button" id="btnGuardarNuevoProducto" class="btn btn-primary">Guardar</button>
            </div>
        </form>
        <hr>
        <table id="tablaNuevosProductos" class="table table-dark table-bordered" style="margin-top:20px;width:100%;">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Nombre</th>
                    <th>Línea</th>
                    <th>ISV</th>
                    <th>Cantidad</th>
                    <th>Costo Unitario</th>
                    <th>Precio Público</th>
                </tr>
            </thead>
            <tbody>
                <!-- Productos agregados aparecerán aquí -->
            </tbody>
        </table>
    </div>
</div>
<div id="minimized-nuevo-producto" style="display:none; position:fixed; bottom:24px; left:24px; z-index:9999;">
    <button class="window-restore btn btn-primary btn-sm">
        <i class="fas fa-plus-circle"></i> Nuevo Producto
    </button>
</div>